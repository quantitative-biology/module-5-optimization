---
title: "Module 5: Optimization Solutions"
output: html_document
---

### Exercise 1

Consider the following dataset, which corresponds to measurements of drug concentration in the blood over time. The trend in the data suggests it can be well-captured by a biexponential $C(t) = a_1 e^{-r_1 t} + a_2 e^{-r_2 t}$. Set up a sum of squared errors function and use either the gradient descent function above or the ```nls``` command to determine the best-fit estimates of the parameters $a_1$, $a_2$, $r_1$ and $r_2$. Next, try fitting the data to a single exponential $C(t) = a e^{-r t}$. Can this simple exponential model also fit the data well? (If you choose to apply gradient descent, you'll need to write a function that generates the sum of squared errors, and you'll need to use a small stepsize, e.g. $10^{-5}$, and a large number of iterations.)


```{r exercise-1-dataset, echo = TRUE}

t <- c(0, 10, 20, 30, 40, 50, 60, 70, 80, 90, 100)
C <- c(6.3, 3.5, 2.8, 2.4, 2.0, 1.9, 1.6, 1.4, 1.3, 1.2, 1.1)
BE_data=cbind(t,C)
plot(BE_data)
```

### Solution

 <!--SOLUTION #true values: 3,3, 0.1, 0.01-->
<!-- ```{r exercise-1-grad-descent-soln, echo = TRUE} -->
<!-- #define SSE -->
<!-- determine_sse <- function(x){ -->
<!--   pred<-(x[1]*exp(-x[2]*T)+x[3]*exp(-x[4]*T)) -->
<!--   obs<-C -->
<!--   sse<-sum((obs - pred)^2) -->
<!--   return(sse) -->
<!-- } -->
<!-- x0 = c(3,0.1,3,0.01) -->
<!-- gd = grad.descent(determine_sse,x0,step.size=0.00001,max.iter=20000,  -->
<!--                         stopping.deriv=0.01) -->
<!-- x0_out <- c(gd$x, simpleFun(gd$x)) -->
<!-- x0_out -->
<!-- plot(BE_data) -->
<!-- curve(x0_out[1]*exp(-x0_out[2]*x)+x0_out[3]*exp(-x0_out[4]*x), from = 0, to = 100, add=TRUE, col='firebrick') -->
<!-- ``` -->

<!-- ```{r exercise-1-grad-descent-part-2-soln, echo = TRUE} -->
<!-- #define SSE -->
<!-- determine_sse <- function(x){ -->
<!--   pred<-(x[1]*exp(-x[2]*T)) -->
<!--   obs<-C -->
<!--   sse<-sum((obs - pred)^2) -->
<!--   return(sse) -->
<!-- } -->
<!-- x0 = c(3,0.01) -->
<!-- gd = grad.descent(determine_sse,x0,step.size=0.00001,max.iter=20000,  -->
<!--                         stopping.deriv=0.01) -->
<!-- x0_out <- c(gd$x, simpleFun(gd$x)) -->
<!-- x0_out -->
<!-- plot(BE_data) -->
<!-- curve(x0_out[1]*exp(-x0_out[2]*x), from = 0, to = 100, add=TRUE, col='firebrick') -->
<!-- ``` -->


<!-- ```{r exercise_1_nls_soln, echo = FALSE} -->
<!-- BEmodel.nls <- nls(C ~ a_1*exp(r_1*T) + a_2*exp(r_2*T),start = list(a_1 = 3, a_2=3, r_1 = 0.01, r_2=0.1)) -->
<!-- summary(BEmodel.nls) -->

<!-- params <- summary(BEmodel.nls)$coeff[,1] #extracting the parameter estimates -->
<!-- plot(BE_data) -->
<!-- curve(params[1]*exp(params[3]*x) + params[2]*exp(params[4]*x), from = 0, to = 100, add=TRUE, col='firebrick') -->
<!-- ``` -->

<!-- ```{r exercise_1_part_2_nls_soln, echo = FALSE} -->
<!-- BEmodel.nls <- nls(C ~ a*exp(r*T),start = list(a = 3,  r = 0.01)) -->
<!-- summary(BEmodel.nls) -->

<!-- params <- summary(BEmodel.nls)$coeff[,1] #extracting the parameter estimates -->
<!-- plot(BE_data) -->
<!-- curve(params[1]*exp(params[2]*x), from = 0, to = 100, add=TRUE, col='firebrick') -->
<!-- ``` -->


